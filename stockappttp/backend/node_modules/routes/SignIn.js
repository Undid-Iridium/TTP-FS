const router = require("express").Router();
var ObjectID = require('mongodb').ObjectID;//Gets mongodb id
function typeOf(obj) {
  return {}.toString.call(obj).split(' ')[1].slice(0, -1).toLowerCase();
}
//const passport = require('passport');
//require('../config/passport');
//LocalStrategy = require('passport-local').Strategy; //./database_route.js
//const Sequelize = require('sequelize');
//const jwebtoken = require('jsonwebtoken');
// const jwtSecret = require('../config/jwtConfig')
const cors = require('cors')
let globalVariable = { db: null };

function initAssessmentRoutes(options) {
    globalVariable = options;
}    

/*router.get(() => {
	res.status(404).send("Sorry, can't find that!");
	res.redirect('/404.html');
});*/


/*router.get('/', function(req, res) {
    res.send('GET handler for /database_route.');
});

router.post('/', function(req, res) {
    res.send('POST handler for /database_route.');
});*/

module.exports = {
    assessmentRoutes: router,
    initAssessmentRoutes,
};

router.route('/update/:id').post(function(req,res) {
    res.send("Updated " + req.params.id);
})

router.route('/addToDB').post(function(req, res) {
    let obj = req.body;
    console.log(obj);
    globalVariable.db.findOne({"Email" : obj.Email}, (err, item) => {
            if(!item){
                globalVariable.db.insertOne(obj)
                .then(todo => {
                    res.status(200).json({'obj': 'obj added successfully'});
                })
                .catch(err => {
                    res.status(400).send('adding new obj failed');
                });
            }
            else{
                res.send({error : "Email already choosen"});
            }
    });
});

router.get('/db', (req, res) => {
    console.log(req.query.username);
    //res.send(req.query.username);
    res.send(req.query.username + "  " + req.query.password);
});

/*router.post('/addToDB', cors(),(req, res) => {
    res.status(200).json({ response : 'added to DB'});
});*/

router.delete('/removeFromDB', (req, res) => {
  res.send('removed from DB');
});




